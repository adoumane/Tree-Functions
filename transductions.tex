\section{Trees and transductions}
\label{sec:trees-transductions}
A \emph{ranked set} is a set where each element has an associated \emph{arity} in $\set{0,1,2,\ldots}$. We use ranked sets as building blocks for trees. The following picture describes the notion of trees that we use and some terminology:
\mypic{1}
% When talking about elements of a ranked set, we mean elements of the underlying set.   For a ranked set $A$ and a finite set of variables $X \subseteq \varnames$, we write $\slice A X$ for the elements of $A$ that have arity $X$. 

We use standard tree terminology, such as ancestor, descendant, child, parent. We write $\trees \Sigma$ for the set of trees over a ranked set $\Sigma$. 
We define a \emph{tree language} over a ranked alphabet $\Sigma$ to be any subset of $\trees \Sigma$. A \emph{tree transduction} is any function
\begin{align*}
f : \trees \Sigma \to \trees \Gamma.
\end{align*}
The ranked set $\Sigma$ is called the \emph{input alphabet}, while $\Gamma$ is called the \emph{output alphabet}. The goal of this paper is to characterise 


  
\paragraph*{Logic on trees.} For an introduction to the  logic-automata connection, see~\cite{thomas1997languages}. The basic idea is to view a tree as a model, and then to use logics such as first-order logic  or monadic second-order logic to describe properties of this model.

\begin{definition}[Tree as a model]\label{def:tree-model}
    The \emph{model} $\underline t$  associated to a  tree $t$ over a ranked alphabet $\Sigma$ has as its universe the nodes of the tree, and is equipped with the following predicates:
    \begin{align*}
        \underbrace{x < y}_{\substack{\text{$x$ is an ancestor of $y$}}} \qquad \underbrace{\mathrm{child}_i(x)}_{\substack{\text{$x$ is an $i$-th child}\\ \text{(one unary predicate for each $i\in \set{1,2,\ldots}$)}}}
        \qquad \underbrace{a(x)}_{\substack{\text{$x$ has label $a$}\\ \text{(one unary predicate for each $a \in \Sigma$)}}}
    \end{align*}
    \end{definition}
 To express properties of trees, we use first-order logic and monadic second-order logic \mso. For definitions of these logics, see~\cite[Section 3]{thomas1997languages}.
 A sentence of first-order logic (or \mso) describes a tree language, i.e.~a set of trees over a fixed alphabet.
 
 The main topic of this paper is not tree languages, but tree-to-tree functions.
The following definition shows how to describe  a tree-to-tree function using logic. A \emph{relational vocabulary} is a set of relation names, each one with associated arity -- formally speaking this is the same thing as a ranked set. 

\begin{definition}[First-order transduction]\label{def:fo-transduction}
    The syntax of a \emph{first-order transduction}  is given by:
\begin{enumerate}
    \item Input and output relational vocabularies $\tau,\sigma$;
    \item A copying constant $k \in \set{1,2,\ldots}$;
    \item For every $i \in \set{1,\ldots,k}$ a \emph{universe formula} $\varphi_i(x)$ over the input vocabulary $\tau$;
    \item For every $n$-ary relation name $R$ in the input vocabulary, and every tuple $\bar i \in \set{1,\ldots,k}^n$, a first-order formula $\varphi_R^{\bar i}(x_1,\ldots,x_n)$ over $\tau$.
\end{enumerate}
\end{definition}

The semantics of a first-order transduction is  a function
\begin{align*}
    \text{models over $\sigma$} \quad \to \quad \text{models over $\tau$}
\end{align*}
defined as follows. If the input model is $\mathbb A$, then the output model is defined as follows. The universe consists of pairs $(a,i)$ such that $a$ is an element of the input model and $i \in \set{1,\ldots,k}$ is such that $\varphi_i(a)$ is true. The predicates are interpreted analogously, using the formulas from item 4. 
\begin{align*}
    \set{(a,i) : a \in \mathbb A, i \in \set{1,\ldots,k} , \mathbb A \models \varphi_i(a)}
\end{align*}

We care about first-order transductions that input and output trees. By abuse of notations, we say that a  function 
    \begin{align*}
        f : \trees \Sigma \to \trees \Gamma
    \end{align*}
    is  a first-order transduction if there is a first-order transduction which gives the same result, assuming the trees are encoded as models as in Defintion~\ref{def:tree-model}.   

    We will also talk about \mso tree-to-tree transductions, which are defined the same way, except that the formulas of item 4 are allowed to use \mso. 
