\newcommand{\simplefun}[4]{
    \begin{tabular}{cc}
        $\ranked{
        \xymatrix@C=1cm{
#2 \ar[r]^-{#1}& #3
        }}$
        \\
        {#4}
    \end{tabular}   
 }

 \newcommand{\reversiblefun}[4]{
    \begin{tabular}{cc}
        $\ranked{
        \xymatrix@C=1cm{
#2 \ar@<.5ex>[r]^-{#1}& #3
\ar@<.5ex>[l]
        }}$
        \\
        {#4}
    \end{tabular}   
 }



 \newcommand{\laterfun}[3]{
    \begin{tabular}{cc}
        $\ranked{
        \xymatrix@C=1.5cm{
#1 & #2
        }}$
        \\
#3
    \end{tabular}   
 }
 

\begin{figure*}
$$\begin{array}{cc}
\textbf{Monad $\tmonad$} & \textbf{Graded monad $\reduce k$}\\[5pt]
\begin{array}{ll}
   \simplefun
        {\unit_\Sigma}
        {\Sigma}
        {\tmonad \Sigma}
        {
      \includegraphics[page=10,scale=0.3]{pics}}
        & 
        \simplefun
        {\flatt_\Sigma}
        {\tmonad \tmonad \Sigma}
        {\tmonad \Sigma} 
        {\includegraphics[page=73,scale=0.3]{pics}}
\end{array} & \begin{array}{ll}
\simplefun
        {\mathrm{g-unit}_\Sigma}
        {\Sigma}
        {\reduce 1 \Sigma}
        {
      \includegraphics[page=10,scale=0.3]{pics}}
        & 
        \simplefun
        {\mathrm{g-flat}_\Sigma}
        {\reduce k \reduce l \Sigma}
        {\reduce{k.l} \Sigma} 
        {\includegraphics[page=73,scale=0.3]{pics}}
\end{array}
\end{array}$$

\begin{center}
$$
\begin{array}{ccc}
\textbf{Accocativity} \qquad&\qquad  \textbf{Commutativity} \qquad&\qquad   \textbf {Shallow terms}\\[5pt]
\begin{array}{c}
\ranked{(\Sigma \otimes \Gamma)\otimes \Delta \to \Sigma \otimes (\Gamma\otimes \Delta)} \\[5pt] \ranked{(\Sigma + \Gamma)+ \Delta \to \Sigma + (\Gamma+ \Delta)}  \\[5pt] \ranked{(\Sigma . \Gamma). \Delta \to \Sigma . (\Gamma . \Delta)}
\end{array}
&
\begin{array}{c}
\ranked{\Sigma_1 + \Sigma_2 \to \Sigma_2 + \Sigma_1} \\[5pt] \ranked{\Sigma_1 \otimes \Sigma_2 \to \Sigma_2 \otimes \Sigma_1}
\end{array}
&
\qquad\begin{array}{c}
      \reversiblefun
        {}
        {\rSigma}
        {\shallowterm {\Sigma} 1}
        {}
        \\[5pt]
        \reversiblefun
        {\composeterm}
        {1 + \shallowterm \Sigma {\tmonad \Sigma} }
        { \tmonad \Sigma}
        {
        \begin{tabular}{l}
            Every term is either just a port,\\ or has a root and child subterms.    
        \end{tabular}    
        }
\end{array}\end{array}$$
\end{center}

$$
\begin{array}{ccc}
 & \textbf{Distributivity} &\\[5pt]
\reversiblefun
        {}
        {\shallowterm {(\Sigma_1 + \Sigma_2)} \Gamma}
        {(\shallowterm {\Sigma_1} \Gamma) + (\shallowterm {\Sigma_2} \Gamma)}{}
        &
        \reversiblefun
        {}
        {(\Sigma_1 + \Sigma_2)\otimes \Gamma}
        {(\Sigma_1 \otimes \Gamma) + (\Sigma_2 \otimes \Gamma)}{}
        & \reversiblefun
        {}
        {\shallowterm {(\Sigma_1 \otimes \Sigma_2)} \Gamma}
        {(\shallowterm {\Sigma_1} \Gamma) \otimes (\shallowterm {\Sigma_2} \Gamma)}{}\\[5pt]
%        {(a,i)\tensorpair{b_1,\ldots,b_n} \mapsto (a\tensorpair{b_1\ldots,b_n}) }
%       &
%        {\tensorpair{(a,i),b} \mapsto (\tensorpair{a,b},i)}
%       &
%        {
%        \begin{tabular}{c}
%            $\tensorpair{a_1,a_2}\tensorpair{b_1,\ldots,b_n} \mapsto$ \\
%            $\tensorpair{a_1 \tensorpair{b_1,\ldots,b_{n_1}}, a_2\tensorpair{b_{n_1+1},\ldots,b_n} }$  \\
%            where $n_1$ is the arity of $a_1$
%            \end{tabular}}\\[15pt]         
%            
      \simplefun
        {}
        {\reduce k (\Sigma_1 + \Sigma_2)}
        {\reduce k \Sigma_1 + \reduce k \Sigma_2}{}
      %  {$(a,i)/f \mapsto ((a/f),i)$}
         & 
	\simplefun
        {}
        {\reduce k (\Sigma_1 \otimes \Sigma_2)}
        {\reduce k ((\reduce k {\Sigma_1})\otimes (\reduce k \Sigma_2))}{}        
	&
	 \simplefun
        {}
        {(\reduce k \Sigma_1) \otimes (\reduce k {\Sigma_2})}
         {\reduce k (\Sigma_1 \otimes \Sigma_2)}
        {}  \\[5pt] 

         \simplefun
        {}
        {\shallowterm \Sigma {\reduce k \Gamma}}
         {\reduce k (\shallowterm \Sigma {\Gamma})}{} &        
         \simplefun
        {}
        {\tmonad {\reduce 1\Sigma}}
         {\reduce 1 \tmonad \Sigma}{}
         & 
         \simplefun
        {}
        {\tmonad {\reduce k \Sigma}}
         {\reduce k \tmonad \reduce k \Sigma}{}
 \\[15pt]
&         \textbf{Non-trivial functions}  & \\[5pt]
        \simplefun{}
        {\tmonad(\Sigma_1+\Sigma_2) \ar@<.5ex>[r]^{ \ancfact}
        \ar@<-.5ex>[r]_{\decfact}}
        {\tmonad(\tmonad \Sigma_1 + \tmonad \Sigma_2)} 
        {} 
        &
        \simplefun{}
        {\tmonad \Sigma \ar[r]^-{\preorder}}
        {\reduce 1 \tmonad(\rSigma + 0 + 2)}
        {} 
        &
        \simplefun{}
        {\shallowterm{(\reduce k \Sigma)}{\Gamma^k} \ar[r]^-{\unfold}}
        {\reduce 1(\shallowterm \Sigma \Gamma)}
        {} 
         \end{array}
$$

$$
\begin{array}{cc}
\textbf{Injections} \qquad&\qquad \textbf{Projections}\\
\begin{array}{ll}
\ranked{\Sigma \to \Sigma+\Sigma} & \ranked{\Sigma \to \reduce k \Sigma^k}  \\ \ranked{\reduce k \Sigma \to \reduce {k+l}\Sigma}  &  
\ranked{\Sigma^n\to  \shallowterm n \Sigma}
\end{array}\qquad&\qquad
\begin{array}{ll}
\ranked{\Sigma+\Sigma\to \Sigma} & \ranked{\Sigma\otimes \Sigma \to \reduce 1 \Sigma} \\\ranked{\reduce {k+1} \Sigma \to \reduce {k}\Sigma+\bot} &
\ranked{\shallowterm n \Sigma \to \Sigma^n}
\end{array}
\end{array}
$$
\caption{    \label{fig:fo-term}The atomic functions. The functions are parametrised by types  $\rSigma, \ranked{\Sigma_1}, \ranked{\Sigma_2}, \rGamma$. Some of the functions are bijections, as indicated by double arrows, in these cases both the function and its inverse are atomic functions. }
\end{figure*}



%
%
%\newpage
%\begin{enumerate}
%\item \textbf{The monad $\tmonad$.}
%$$\begin{array}{ll}
%  \simplefun
%        {\unit_\Sigma}
%        {\Sigma}
%        {\tmonad \Sigma}
%        {
%      \includegraphics[page=10,scale=0.4]{pics}}
%        & 
%        \simplefun
%        {\flatt_\Sigma}
%        {\tmonad \tmonad \Sigma}
%        {\tmonad \Sigma} 
%        {\tablepic{73}}
%\end{array}$$
%\item \textbf{The graded monad $\reduce k$.}
%$$\begin{array}{ll}
%  \simplefun
%        {}
%        {\Sigma}
%        {\reduce 1 \Sigma^1}
%        {} &
%        \simplefun
%        {}
%        {\reduce {k_1} \reduce {k_2} \Sigma}
%        {\reduce {k_1 \cdot k_2} \Sigma}
%        {$(a/f)/g \mapsto a/(g \circ f)$}
%        \end{array}$$
%\item \textbf{Associativity functions.}
%$$\begin{array}{lll}
%\ranked{(\Sigma \otimes \Gamma)\otimes \Delta \to \Sigma \otimes (\Gamma\otimes \Delta)} \quad &\quad \ranked{(\Sigma + \Gamma)+ \Delta \to \Sigma + (\Gamma+ \Delta)}  \quad&\quad \ranked{(\Sigma . \Gamma). \Delta \to \Sigma . (\Gamma . \Delta)}
%\end{array}$$
%\item \textbf{Distributivity functions}.
%$$\begin{array}{ll}
%      \simplefun
%        {}
%        {\reduce k (\Sigma_1 + \Sigma_2)}
%        {\reduce k \Sigma_1 + \reduce k \Sigma_2}
%        {$(a,i)/f \mapsto ((a/f),i)$}
%         & 
%        \reversiblefun
%        {}
%        {(\Sigma_1 + \Sigma_2)\otimes \Gamma}
%        {(\Sigma_1 \otimes \Gamma) + (\Sigma_2 \otimes \Gamma)}
%        {$\tensorpair{(a,i),b} \mapsto (\tensorpair{a,b},i)$}
%        \\ \\
%        \reversiblefun
%        {}
%        {\shallowterm {(\Sigma_1 + \Sigma_2)} \Gamma}
%        {(\shallowterm {\Sigma_1} \Gamma) + (\shallowterm {\Sigma_2} \Gamma)}
%        {$(a,i)\tensorpair{b_1,\ldots,b_n} \mapsto (a\tensorpair{b_1,\ldots,b_n})$ }
%        &
%        \reversiblefun
%        {}
%        {\shallowterm {(\Sigma_1 \otimes \Sigma_2)} \Gamma}
%        {(\shallowterm {\Sigma_1} \Gamma) \otimes (\shallowterm {\Sigma_2} \Gamma)}
%        {
%        \begin{tabular}{c}
%            $\tensorpair{a_1,a_2}\tensorpair{b_1,\ldots,b_n} \mapsto$ \\
%            $\tensorpair{a_1 \tensorpair{b_1,\ldots,b_{n_1}}, a_2\tensorpair{b_{n_1+1},\ldots,b_n} }$  \\
%            where $n_1$ is the arity of $a_1$
%            \end{tabular}}
%            \\
%	\simplefun
%        {}
%        {\reduce k (\Sigma_1 \otimes \Sigma_2)}
%        {\reduce k ((\reduce k {\Sigma_1})\otimes (\reduce k \Sigma_2))}{picture}        
%	&
%	 \simplefun
%        {}
%        {(\reduce k \Sigma_1) \otimes (\reduce k {\Sigma_2})}
%         {\reduce k (\Sigma_1 \otimes \Sigma_2)}
%        {picture}  \\
%        
%         \simplefun
%        {}
%        {\shallowterm \Sigma {\reduce k \Gamma}}
%         {\reduce k (\shallowterm \Sigma {\Gamma})}
%        
%&        
%\end{array} $$
%\item \textbf{Commutativity functions.} 
%$$\begin{array}{ll}
%\ranked{\Sigma_1 + \Sigma_2 \to \Sigma_2 + \Sigma_1} \qquad & \qquad  \ranked{\Sigma_1 \otimes \Sigma_2 \to \Sigma_2 \otimes \Sigma_1}
%\end{array}
%$$
%\item \textbf{Shallow terms.} 
%   $$\begin{array}{lll}
%   \reversiblefun
%        {}
%        {\rSigma}
%        {\shallowterm 1 {\Sigma} }
%        {picture}
%        &
%      \reversiblefun
%        {}
%        {\rSigma}
%        {\shallowterm {\Sigma} 1}
%        {picture}
%        &
%        \reversiblefun
%        {\composeterm}
%        {1 + \shallowterm \Sigma {\tmonad \Sigma} }
%        { \tmonad \Sigma}
%        {
%        \begin{tabular}{c}
%            Every term is either just a port,\\ or has a root and child subterms.    
%        \end{tabular}    
%        } 
%\end{array} $$     
%\item \textbf{The error type $\bot$.} Some error raising mechanisms.
%$$\begin{array}{llll}
%\ranked{\Sigma \to \bot} \quad&\quad \ranked{\tmonad(\Sigma+\bot)\to \tmonad\Sigma+\bot} \quad&\quad \ranked{\reduce k (\Sigma+\bot)\to \reduce k\Sigma+\bot}\quad&\quad  \ranked{(\Sigma+\bot)\otimes \Gamma\to \Sigma\otimes \Gamma+\bot}
%\end{array}$$     
%\item \textbf{Injections.}
%$$\begin{array}{llll}
%\ranked{\Sigma \to \Sigma+\Sigma} \quad &\quad \ranked{\Sigma \to \reduce k \Sigma^k}  \quad & \quad \ranked{\reduce k \Sigma \to \reduce {k+l}\Sigma} \quad & \quad 
%\ranked{\Sigma^n\to  \shallowterm n \Sigma}
%\end{array}$$
%\item \textbf{Projections.}
%$$\begin{array}{llll}
%\ranked{\Sigma+\Sigma\to \Sigma} \quad &\quad \ranked{\Sigma\otimes \Sigma \to \reduce 1 \Sigma} \quad & \quad \ranked{\reduce {k+1} \Sigma \to \reduce {k}\Sigma+\bot} \quad & \quad 
%\ranked{\shallowterm n \Sigma \to \Sigma^n} 
%\end{array}$$
%\item \textbf{Factorisations.} Same as before.
%\item \textbf{Pre-order.} Same as before.
%\item \textbf{Unfolding.} We have 3 unfolding functions. The first is the shallow unfold, the second is 
%\begin{align*}
%\ranked{\tmonad \reduce 1 \Sigma \to \reduce 1 \tmonad \Sigma }
%\end{align*}
%The third is \emph{the unfolding of external twists}. This function, which is of type 
%\begin{align*}
%\ranked{\tmonad \mati k \Sigma \to \reduce k \tmonad \mati k \Sigma}
%\end{align*}
%"untwists" the external twists  as illustrated by the following figure where the external twists have been colored in red. 
%\begin{center}
%\includegraphics[scale=.4]{external-unfold.pdf}
%\end{center}
%\end{enumerate}
%
